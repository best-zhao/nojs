/*nolure@vip.qq.com*/define("lib/nojs/mods/pjax",["lib/jquery/jquery"],function(require){function a(c){this.options=c=b.extend(!0,{},a.config,c),a.support&&(this.selector="string"==typeof c.selector?b(c.selector):c.selector,this.container=c.container,this.selector.length&&this.container&&this.container.length&&this.init())}var b=require("lib/jquery/jquery"),c=0;return a.support=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]|WebApps\/.+CFNetwork)/),a.config={timeout:3e3,ajaxSettings:{type:"get",dataTpye:"json"}},a.item={},a.state=null,a.cache={},window.onpopstate=function(b){var c;b&&b.state&&a.item[b.state.index]&&(c=a.item[b.state.index],"function"==typeof c.options.start&&c.options.start.call(c),c.onPopstate(b.state))},a.prototype={init:function(){var b=this;this.selector.on("click.pjax",function(a){b.handle(a)}),this.index=++c,a.item[c]=this},handle:function(a){var b=a.target;if("a"==b.tagName.toLowerCase()&&!(a.which>1||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)&&location.protocol===b.protocol&&location.hostname===b.hostname)return b.href.split("#")[0]==location.href.split("#")[0]?void a.preventDefault():void(a.timeout||(a.preventDefault(),this.target=b,this.pjax(a)))},pjax:function(){var c=this.container.offset().top,d=this.target;if("number"==typeof this.options.scrollTop&&(c=this.options.scrollTop),d&&d.hash){var e=b(d.hash);e.length&&b(window).scrollTop(e.offset().top)}b(window).scrollTop(c),"function"==typeof this.options.start&&this.options.start.call(this);var f=d.href,g=this.options;if("function"==typeof g.url&&(f=g.url.call(this,f)),a.cache[f])return void this.onPopstate(a.cache[f],!0);var h,i,j=this,k=b.extend(!0,{},b.ajaxSettings,g.ajaxSettings),l=g.timeout;a.support&&(a.state={index:this.index,title:document.title,url:location.href,content:this.container.html()},window.history.replaceState(a.state,document.title)),k.beforeSend=function(a){a.setRequestHeader("X-PJAX","true"),l>0&&(i=setTimeout(function(){a.abort(),location.href=d.href},l))},k.complete=function(){i&&(i=clearTimeout(i))},k.success=function(c){if(1==c.status){a.state.url=f;var d=c.data;"function"==typeof g.data&&(d=g.data(c)),a.state.content=d,a.cache[f]=b.extend({},a.state),j.onPopstate(a.state,!0)}},k.error=function(){},k.url=f,h=b.ajax(k),h.readyState>0},onPopstate:function(b,c){a.support&&c&&(window.history.pushState(b,""),window.history.replaceState(b,"",b.url)),document.title=b.title,this.container.html(b.content),"function"==typeof this.options.end&&this.options.end.call(this),"function"==typeof this.options.callback&&this.options.callback.call(this)}},a});