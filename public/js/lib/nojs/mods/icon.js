/*nolure@vip.qq.com*/define("lib/nojs/mods/icon",["lib/jquery/jquery","lib/nojs/ui"],function(require){function a(d,e){return this instanceof a?(this.options=e=b.extend(c.config.icon,e),this.hasCanvas=!!document.createElement("canvas").getContext,this.type=e.type||"loading",this.element=b('<i class="nj_icon nj_i_'+this.type+'"></i>'),void((d=c.dom(d))&&(d.html(this.element),this.canvas=null,this.ctx=null,this.width=e.width||this.element.width()||16,this.height=e.height||this.element.height()||16,this.color=e.color||this.element.css("color"),this.bgcolor=e.bgcolor||this.element.css("background-color"),this.element.css({background:"none",width:this.width,height:this.height}),this.createSpace()))):new a(d,e)}var b=require("lib/jquery/jquery"),c=require("lib/nojs/ui");return a.prototype={createSpace:function(){var b=document;if(this.hasCanvas)this.canvas=b.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.width,this.canvas.height=this.height,this.element.append(this.canvas);else{if(!a.iscreatevml){var c=b.createStyleSheet(),d=["polyline","oval","arc","stroke","shape"];b.namespaces.add("v","urn:schemas-microsoft-com:vml");for(var e=0;e<d.length;e++)c.addRule("v\\:"+d[e],"behavior:url(#default#VML);display:inline-block;");a.iscreatevml=!0}this.element.css("position","relative")}this.draw()},drawLine:function(a,c,d){var e,f=a.length;if(this.hasCanvas){for(this.ctx.beginPath(),this.ctx.moveTo(a[0],a[1]),e=2;f>e;e+=2)this.ctx.lineTo(a[e],a[e+1]);this.ctx.stroke(),c&&this.ctx.fill()}else{var g="",h="";for(e=0;f>e;e+=2)g+=a[e]+","+a[e+1]+" ";h+='<v:polyline strokeWeight="'+d+'" filled="'+(c?"true":"false")+'" class="polyline" strokecolor="'+this.color+'" points="'+g+'" ',c&&(h+='fillcolor="'+this.color+'"'),h+="/>",b(this.canvas).after(h)}},draw:function(){var a,d,e,f=Math.PI,g=this.width,h=this.height,i=this.color,j=(this.bgcolor,this.ctx),k=this;if("loading"==this.type){if(e=3,this.hasCanvas){a=f/180,d=200*f/180,j.strokeStyle=this.color,j.lineWidth=e;var l=function(){j.clearRect(0,0,g,h),a+=.15,d+=.15,j.beginPath(),j.arc(g/2,h/2,g/2-e+1,a,d,!1),j.stroke()}}else{a=0,e--;var m="left:1px;top:1px;width:"+(g-2*e+1)+"px;height:"+(h-2*e+1)+"px";this.canvas=document.createElement('<v:arc class="oval" filled="false" style="'+m+'" startangle="0" endangle="200"></v:arc>'),b(this.canvas).append('<v:stroke weight="'+e+'" color="'+i+'"/>'),this.element.append(this.canvas);var l=function(){a+=7,a=a>360?a-360:a,k.canvas.rotation=a}}c.animationLoop({callback:l,loop:!0})}else this["Draw"+this.type]&&this["Draw"+this.type]()}},a});