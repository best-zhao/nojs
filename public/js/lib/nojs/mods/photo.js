/*nolure@vip.qq.com*/define("lib/nojs/mods/photo",["lib/jquery/jquery","lib/nojs/ui","./fullscreen"],function(require){function a(){var a=[],b=null,c=function(){for(var b=0;b<a.length;b++)a[b].end?a.splice(b--,1):a[b]();!a.length&&d()},d=function(){clearInterval(b),b=null};return function(d,e,f,g){var h,i,j,k,l,m=new Image;return m.src=d,m.complete?(e.call(m),void(f&&f.call(m))):(i=m.width,j=m.height,m.onerror=function(){g&&g.call(m),h.end=!0,m=m.onload=m.onerror=null},h=function(){k=m.width,l=m.height,(k!==i||l!==j||k*l>1024)&&(e.call(m),h.end=!0)},h(),m.onload=function(){!h.end&&h(),f&&f.call(m),m=m.onload=m.onerror=null},void(h.end||(a.push(h),null===b&&(b=setInterval(c,40)))))}}function b(a,b){this.box="string"==typeof a?d("#"+a):a,this.options=b=b||{},this.item=this.box.find(".pic_list .list").children(),this.length=this.item.length,this.wrap=b.wrap||this.box,this.full=null,this.index=b.index||0,this.type=b.type,this.init()}function c(a,b){b=b||{},b.type="lightbox",b.wrap=d('<div class="lightbox_wrap"><div class="content"><div class="img"></div><i class="loading"></i><i class="p prev"></i><i class="p next"></i><i class="close"></i></div><div class="info"></div></div>').appendTo(d("body")),this.layer=e.layer,this.align=new e.align({nearby:window,element:b.wrap}),this.fullScreen=b.fullScreen,c.baseConstructor.call(this,a,b)}var d=require("lib/jquery/jquery"),e=require("lib/nojs/ui"),f=require("./fullscreen");return b.prototype={init:function(){this.content=this.wrap.children(".content"),this.info=this.wrap.children(".info"),this.img=this.wrap.find(".img"),this.close=this.wrap.find(".close"),this.loading=this.wrap.find(".loading"),this.ready=a(),this.image=d('<img src="" />'),this.bind()},bind:function(){for(var a,b=this,e=0,a=0;a<this.length;a++)e+=this.item.eq(a).outerWidth(!0);this.info.find(".pic_list .list").width(e),this.number=this.wrap.find(".num"),this.number.find("i").text(this.length),this.page=this.wrap.find("i.p").css({opacity:"0.4"}),this.page.click(function(a){a.preventDefault(),b.load(d(this).hasClass("prev")?--b.index:++b.index)}).hover(function(){d(this).is(":visible")&&d(this).stop().fadeTo(200,1)},function(){d(this).is(":visible")&&d(this).stop().fadeTo(200,.2)}),this.wrap.click(function(a){var e,f,g,h,i=a.target,j=i.tagName.toLowerCase();if("a"==j){if(f=d(i),e=f.attr("data-action"),"full"==e){if(!b.full){var k=d.extend({},b.options);k.onChange=function(a){b.load(a)},b.full=new c(b.box,k)}return b.full.show(b.index),!1}if("full_screen"==e)return g=d(window).height(),h||(h=b.content.height()/g),b.fullScreen=b.fullScreen?null:!0,b.content.animate({height:b.fullScreen?g:g*h},200,function(){b.fullScreen?b.content.height("100%"):b.content.removeAttr("style"),b.load(b.index,!0)}),b.close.hide(),f.text(b.fullScreen?"退出全屏":"全屏"),!1;if("close"==e)return b.hide(),!1}}),this.item.each(function(a){var c=d(this);!function(a){c.click(function(){return b.load(a),!1})}(a)}),"lightbox"!=this.type&&this.load(this.index)},createPageIco:function(a){function b(a){var b,c=this.width,e=this.height,f=this.ctx;this.hasCanvas?(f.lineWidth=7,f.strokeStyle="#000"):(this.canvas=d("<i></i>"),this.ico.append(this.canvas),this.color="#BABABA"),b="prev"==a?[.8*c,0,.1*c,.5*e,.8*c,e]:[.2*c,0,.9*c,.5*e,.2*c,e],this.drawLine(b,!1,3),this.hasCanvas?(f.lineWidth=5,f.strokeStyle="rgba(255,255,255,0.7)"):this.color="#000000",this.drawLine(b,!1,4)}e.ico.prototype.Drawprev=function(){b.call(this,"prev")},e.ico.prototype.Drawnext=function(){b.call(this,"next")};var c={type:"prev",width:50,height:110,color:"#000000",bgcolor:"#cccccc"};new e.ico(a.eq(0),c),c.type="next",new e.ico(a.eq(1),c),c.width=18,c.height=36,new e.ico(a.eq(3),c),c.type="prev",new e.ico(a.eq(2),c),new e.ico(this.loading,{type:"loading",color:"#006CFF",width:48,height:48}),new e.ico(this.close,{type:"close",bgcolor:"#999",color:"#000",width:32,height:32})},srcRule:function(a,b){return this.options.srcRule?this.options.srcRule(a,b):a},load:function(a,b){if(a=parseInt(a)||0,a=a>this.length-1?0:a,a=0>a?this.length-1:a,b)return void this.setCenter(this.image[0]);var c,e,f=this,g=d(this.item[a]);if(g.length&&("img"==g[0].tagName.toLowerCase()||(g=g.find("img"),g.length))){this.img.find("img").length||(this.img.show(),this.img.append(this.image)),c=g.attr("src");var e=this.info.find(".wrap img");this.info.find(".wrap").stop().animate({scrollLeft:e.outerWidth()*(a-2)},200),this.number.find("em").text(a+1),this.wrap.find(".title").html(g.attr("data-title")||""),this.wrap.find(".desc").html(g.attr("data-desc")||""),c=this.srcRule(c,g),this.wrap.find('a[data-action="src"]').attr({href:c,target:"_blank"}),this.image.attr("src",c).hide(),this.loading.show(),this.ready(c,function(){f.image.data("size",{width:this.width,height:this.height}),f.setCenter(this)},function(){f.loading.hide(),setTimeout(function(){f.image.show()},100)},function(){f.close.show(),f.loading.hide()}),this.index=a,this.page.show(),0==a&&this.page.eq(0).hide(),a==this.item.length-1&&this.page.eq(1).hide(),this.options.onChange&&this.options.onChange(a),this.info.find(".pic_list .list").children().eq(a).addClass("current").siblings().removeClass("current")}},setCenter:function(a){var b=this,c=this.image.data("size"),d=c?c.width:a.width,e=c?c.height:a.height,f=2*(parseInt(this.img.css("padding-left"),10)||0),g=this.limit({width:d+f,height:e+f}),h=200;d=g.width,e=g.height,this.img.animate({"margin-left":-d/2,"margin-top":-e/2,width:d-f,height:e-f},h,function(){b.close.show()}),d-=f,e-=f,this.image.animate({"margin-left":-d/2,"margin-top":-e/2,width:d,height:e},h),this.close.css({left:this.content.width()/2+d/2+f/2,top:this.content.height()/2-e/2-f/2,display:"none",margin:"-16px 0 0 -16px"})},limit:function(a){var b=a.width,c=a.height,d=this.content.width(),e=this.content.height(),f=b/c,g=d/e;return f>g&&b>d?(b=d,c=b/f):g>=f&&c>e&&(c=e,b=c*f),{width:b,height:c}}},e.extend(c,b),e.extend.proto(c,{bind:function(a){var b,c=this,e=this.info.append(['<div class="pic_list">','<i class="p prev" data-action="scroll"></i>','<i class="p next" data-action="scroll"></i>','<div class="wrap"><div class="list"></div></div>',"</div>",'<div class="txt">','<div class="num"><em></em> / <i></i></div>','<div class="title"></div>','<div class="desc"></div>',"</div>"].join("")).find(".pic_list .list");d.each(this.item,function(a,b){var c="img"==b.tagName.toLowerCase()?d(b):d(b).find("img");c.length&&(c=c.clone().attr({style:""}),e.append(c))}),this.item=e.find("img"),this.close.click(function(){c.hide()}),d(window).resize(function(){clearTimeout(b),c.close.hide(),b=setTimeout(function(){c.load(c.index,!0)},300)}),this.wrap[0].addEventListener(f.fullScreenEventName,function(){!f.isFullScreen()&&c.hide()},!0),a.call(this)}}),c.prototype.show=function(a){f.requestFullScreen(this.wrap[0]),d("html").addClass("lightbox"),this.align.set(),this.wrap.fadeIn(300),this.layer.show(.95),"function"==typeof this.options.onShow&&this.options.onShow.call(this),this.load(a),this.fullScreen&&(this.fullScreen=null,this.info.find("a[data-action=full_screen]").click())},c.prototype.hide=function(){f.cancelFullScreen(this.wrap[0]),d("html").removeClass("lightbox"),this.wrap.hide(),this.layer.hide(),"function"==typeof this.options.onHide&&this.options.onHide.call(this)},{player:b,lightbox:c}}),define("lib/nojs/mods/fullscreen",[],function(){var a={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},b="webkit moz o ms khtml".split(" ");if("undefined"!=typeof document.cancelFullScreen)a.supportsFullScreen=!0;else for(var c=0,d=b.length;d>c;c++)if(a.prefix=b[c],"undefined"!=typeof document[a.prefix+"CancelFullScreen"]){a.supportsFullScreen=!0;break}return a.supportsFullScreen&&(a.fullScreenEventName=a.prefix+"fullscreenchange",a.isFullScreen=function(){switch(this.prefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}},a.requestFullScreen=function(a){return""===this.prefix?a.requestFullScreen():a[this.prefix+"RequestFullScreen"]()},a.cancelFullScreen=function(){return""===this.prefix?document.cancelFullScreen():document[this.prefix+"CancelFullScreen"]()}),a});