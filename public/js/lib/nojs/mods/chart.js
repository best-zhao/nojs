/*nolure@vip.qq.com*/define("lib/nojs/mods/chart",["lib/jquery/jquery"],function(require){function a(a){this.options=a=c.extend(!0,{axisColor:"#c8c8c8",gridColor:"#e8e8e8",fillStyle:"rgba(46,150,220,.2)",strokeStyle:"rgba(46,150,220,.8)",animation:!0,animationEasing:"easeOutQuart",offset:{left:30,bottom:50,top:18,right:15,paddingTop:0,paddingBottom:0,paddingRight:0}},a);var b=a.element;this.element=c("string"==typeof b?document.getElementById(b):b).css("position","relative"),this.data=a.data,this.dataStep=null,this.canvas=null,this.ctx=null,this.dataRatio=null,this.dataPoints=[],this.grid={},this.labelPoints=[],this.offset=a.offset,this.scaleFixed=parseInt(this.options.scaleFixed)||0,this.init()}function b(a){function b(){var b=g(h);a.clear(),a.draw(b)}function c(){h+=d,b(),1>=h&&e(c)}var d=1/60,g=f[a.options.animationEasing],h=0;e(c)}var c=require("lib/jquery/jquery"),d=!!document.createElement("canvas").getContext;a.prototype={init:function(){d?(this.canvas=c(document.createElement("canvas")),this.ctx=this.canvas[0].getContext("2d"),this.element.css({paddingTop:this.offset.paddingTop,paddingBottom:this.offset.paddingBottom}),this.canvas[0].width=this.element.width(),this.canvas[0].height=this.element.height(),this.element.append(this.canvas)):(a.createvml(),this.canvas=this.element),this.count()},count:function(){for(var a,c=this.canvas.width(),e=this.canvas.height(),f=this.offset,g=this.data.items,h=g.length,i=0,j=[],k=[];h>i;i++)a=g[i].data,j.push(Math.max.apply(null,a)),k.push(Math.min.apply(null,a));j=Math.max.apply(null,j),k=Math.min.apply(null,k);var l=(j-k)/(e-f.top-f.bottom);this.dataStep=20*Math.round(l),this.dataStep=0==this.dataStep?2*Math.round(10*l)||1:this.dataStep;var m=j%this.dataStep,n=k%this.dataStep;j-=0==m?0:m-this.dataStep,k-=0==n?0:n,k=k>this.dataStep?k:0,this.grid.minY=k,f.left=10*(String(j).length+(this.scaleFixed?this.scaleFixed+1:0)),this.attr={width:c,height:e,max:j,min:k},d&&this.options.animation?b(this):this.draw()},coordinate:function(){var a,b=this.attr.width,c=this.attr.height,d=this.attr.max,e=this.attr.min,f=this.offset;this.drawLine([f.left,c-f.bottom,b,c-f.bottom],{fill:this.options.axisColor,stroke:this.options.axisColor}),this.drawLine([f.left,0,f.left,c-f.bottom],{fill:this.options.axisColor,stroke:this.options.axisColor});var g=(d-e)/this.dataStep;g=e?++g:g;var h,i,j=(c-f.bottom-f.top)/g,k=0;for(this.dataRatio=j/this.dataStep,this.grid.stepY=j,a=1;g>=a;a++)h=c-f.bottom-j*a,this.drawLine([f.left,h,b,h],{stroke:this.options.gridColor}),k+=e&&1==a?e:this.dataStep,i=this.scaleFixed?Number(k).toFixed(this.scaleFixed):k,this.drawText(i,f.left-5,h,"right","middle");var l,m=(b-f.left-f.right)/(this.data.labels.length-1),h=c-f.bottom;for(a=0;a<this.data.labels.length;a++)l=f.left+a*m,this.drawLine([l,0,l,h],{stroke:this.options.gridColor}),this.drawText(this.data.labels[a],l,c,"center","bottom","x"),this.labelPoints.push(l)},draw:function(a){this.coordinate();var b=this.data.items,c=b.length,d=this.canvas.width()-this.offset.right,e=this.canvas.height()-this.offset.bottom,f=e-(this.grid.minY?this.grid.stepY:0),g=this,h=[];a=a||1;var i,j,k,l,m,n,o,p;for(i=0;c>i;i++){for(k=b[i].data,p=k.length,l=[],j=0;p>j;j++)m=this.labelPoints[j],o=n=k[j],this.grid.minY&&(n-=this.grid.minY),n=f-this.dataRatio*n*a,l.push(m,n),function(){var a={arc:[m,n,4,b[i].strokeStyle||g.options.strokeStyle]};if(g.options.showPointData){var c=0==j,d=j==p-1,e="center",f="bottom";c?(e="left",f="middle",m+=7):d?(e="right",f="middle",m-=7):n-=5,a.text=[o,m,n,e,f]}h.push(a)}();this.drawLine(l,{stroke:b[i].strokeStyle||this.options.strokeStyle,lineWidth:1.5}),l.push(d,e),l.push(this.offset.left,e),l.push(this.offset.left,e-this.dataRatio*k[0]),this.drawLine(l,{fill:b[i].fillStyle||this.options.fillStyle})}this.drawArcPoint(h)},drawLine:function(b,c){var e,f=b.length,g=d?this.ctx:this.canvas;if(c=c||{},d){for(g.save(),g.beginPath(),g.lineWidth=c.lineWidth,g.moveTo(b[0],b[1]),e=2;f>e;e+=2)g.lineTo(b[e],b[e+1]);c.stroke&&(g.strokeStyle=c.stroke,g.stroke()),c.fill&&(g.fillStyle=c.fill,g.fill()),g.restore()}else{var h,i="",j="",k=c.lineWidth||1,l=c.fill&&c.fill.match(/(\d+,\d+,\d+),([\.\d]+)/);for(l&&l[2]?(h=l[1].split(","),c.fill=a.RgbToHex(h[0],h[1],h[2],!0),l="filter:alpha(opacity="+100*l[2]+")"):l="",e=0;f>e;e+=2)i+=b[e]+","+b[e+1]+" ";j+='<v:polyline filled="'+(c.fill?"true":"false")+'" class="polyline" style="position:absolute;'+l+'" points="'+i+'" ',c.fill&&(j+='fillcolor="'+c.fill+'"'),c.stroke&&(j+='strokeWeight="'+k+'" strokecolor="'+c.stroke+'"'),j+="/>",g.append(j)}},drawText:function(a,b,c,e,f,g){var h="";d?(this.ctx.save(),"x"==g&&(this.ctx.translate(b,c),this.ctx.rotate(-25*Math.PI/180),b=22,c=-30,e="right"),this.ctx.fillStyle="#888",this.ctx.textAlign=e,this.ctx.textBaseline=f,this.ctx.fillText(a,b,c),this.ctx.restore()):("right"==f?h="position:absolute;left:-100%;top:-50%":"bottom"==f&&(h="position:absolute;bottom:100%;left:-50%"),this.canvas.append('<div style="position:absolute;left:'+b+"px;top:"+c+'px;color:#888;font-size:12px"><div style="'+h+'">'+a+'</div><div style="visibility:hidden">'+a+"</div></div>"))},drawArc:function(a,b,c,e){var f=d?this.ctx:this.canvas;d?(f.save(),f.beginPath(),f.arc(a,b,c,0,2*Math.PI,!0),f.fillStyle=e,f.strokeStyle="rgba(255,255,255,.8)",f.lineWidth=2,f.fill(),f.stroke(),f.restore()):f.append('<v:oval filled="true" fillcolor="'+e+'" strokeWeight="1.5" strokecolor="#fff" style="position:absolute;left:'+(a-c)+"px;top:"+(b-c)+"px;width:"+2*c+"px;height:"+2*c+'px"/>')},drawArcPoint:function(a){for(var b,c=0;c<a.length;c++)b=a[c],this.drawArc.apply(this,b.arc),b.text&&this.drawText.apply(this,b.text)},clear:function(){this.ctx.clearRect(0,0,this.attr.width,this.attr.height)}},a.createvml=function(){if(!a.createvml.init){var b=document.createStyleSheet(),c=["polyline","oval","arc","stroke","shape"];document.namespaces.add("v","urn:schemas-microsoft-com:vml");for(var d=0;d<c.length;d++)b.addRule("v\\:"+c[d],"behavior:url(#default#VML);display:inline-block;");a.createvml.init=!0}},a.RgbToHex=function(a,b,c,d){for(var e,f="",g=[Math.round(a),Math.round(b),Math.round(c)],h=0;h<g.length;h++)e=Number(g[h]).toString(16),1==e.length&&(e="0"+e),f+=e;return d&&(f="#"+f),f};var e=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),f={easeOutExpo:function(a){return 1==a?1:1*(-Math.pow(2,-10*a/1)+1)},easeOutQuart:function(a){return-1*((a=a/1-1)*a*a*a-1)}};return a});