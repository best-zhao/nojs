/*nolure@vip.qq.com*/define("lib/nojs/mods/face",["lib/jquery/jquery","./layer","lib/nojs/ui","./Switch"],function(require){function face(a){this.options=a=$.extend(!0,{},face._config,a),this.button=a.button,this.insert=$(a.insert),this.button&&(this.themes=[],this.pop=null,this.item=null,this.init())}function insertOnCursor(a){a&&a.length&&(this.textBox=a,this.setCaret())}var $=require("lib/jquery/jquery"),layer=require("./layer"),Switch=require("./Switch");return face._config={themeItems:{"default":{name:"默认表情",url:"/",item:{0:"微笑",1:"撇嘴",2:"色",3:"发呆",4:"得意",5:"流泪",6:"害羞",7:"闭嘴",8:"睡",9:"大哭",10:"尴尬",11:"发怒",12:"调皮",13:"龇牙",14:"惊讶",15:"难过",16:"酷",17:"冷汗",18:"抓狂",19:"吐",20:"偷笑",21:"可爱",22:"白眼",23:"傲慢",24:"饥饿",25:"困",26:"惊恐",27:"流汗",28:"憨笑",29:"大兵",30:"奋斗",31:"咒骂",32:"疑问",33:"嘘",34:"晕",35:"折磨",36:"衰",37:"骷髅",38:"敲打",39:"再见",40:"擦汗",41:"抠鼻",42:"鼓掌",43:"糗大了",44:"坏笑",45:"左哼哼",46:"右哼哼",47:"哈欠",48:"鄙视",49:"委屈",50:"快哭了",51:"阴险",52:"亲亲",53:"吓",54:"可怜"},fix:".gif"}}},face.config=function(a){return $.extend(!0,face._config,a)},face.prototype={init:function(){var a=this,b=$.extend({nearby:this.button,className:"face_menu"},this.options.overlay),c=b.onShow;b.onShow=function(){this.element.data("init")||(this.element.data("init",!0),a.loadFace()),c&&c.call(this)},this.pop=new layer.overlay(b),this.pop.on({mode:"click",element:this.button});var d=this.options.themes||[];d="string"==typeof d?[d]:d,$.each(d,function(b,c){var d=a.options.themeItems[c];d&&(d.id=c,a.themes.push(d))})},loadFace:function(){var a=this,b="",c="";$.each(this.themes,function(a,d){b+='<li class="nj_s_m">'+d.name+"</li>",c+='<div class="nj_s_c"><ul class="list clearfix '+d.id+'">';for(var e in d.item)c+='<li><img src="'+d.url+e+d.fix+'" data-name="'+a+"_"+d.item[e]+'" title="'+d.item[e]+'" alt="" /></li>';c+="</ul></div>"});var d=['<div class="nj_face">','<div class="con">','<div class="tit"><ul class="nj_s_menu clearfix">'+b+"</ul></div>",'<div class="nj_s_con clearfix">'+c+"</div>","</div>",'<span class="a"><em>◆</em><i>◆</i></span>',"</div>"].join("");this.pop.set("content",d),this.tab=new Switch.tab(this.pop.content),this.item=this.pop.content.find("ul.list img"),this.pop.element.click(function(b){var c,d=b.target;"img"==d.tagName.toLowerCase()&&(c="[:"+$(d).attr("data-name")+"]",a.insertTo(c),a.pop.hide())})},insertTo:function(a){var b=new insertOnCursor(this.insert);b.insertAtCaret(a),this.insert.focus();var c={theme:this.themes[this.tab.index],text:a,content:this.replaceFace(a)};this.options.onInsert&&this.options.onInsert.call(this,c)},replaceFace:function(con,themes){if(!con)var con=this.insert.val();var T=this;return themes=themes||this.themes,$.each(themes,function(index,v){var faceArray=v.item,N,pic,item;for(var i in faceArray)item=faceArray[i],N=index+"_"+item,-1!=con.indexOf("[:"+N+"]")&&(pic='<img src="'+v.url+i+v.fix+'" alt="'+item+'" class="nj_face_image" title="'+item+'" />',con=con.replace(eval("/\\[:"+N.replace("(","\\(").replace(")","\\)")+"\\]/g"),pic))}),con}},insertOnCursor.prototype={setCaret:function(){if($.browser.msie){var a=this;a.textBox.on("click select keyup",function(){a.textBox[0].caretPos=document.selection.createRange().duplicate()})}},insertAtCaret:function(a){if(this.textBox&&this.textBox.length){var b=this.textBox[0];if(document.all&&b.createTextRange&&b.caretPos){var c=b.caretPos;c.text=""==c.text.charAt(c.text.length-1)?a+"":a}else if(b.setSelectionRange){var d=b.selectionStart,e=b.selectionEnd,f=b.value.substring(0,d),g=b.value.substring(e);b.value=f+a+g;var h=a.length;b.setSelectionRange(d+h,d+h)}else b.value+=a}},unselectContents:function(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},selectContents:function(){this.textBox.each(function(a){var b,c,d,e,f=this;(d=f.ownerDocument)&&(e=d.defaultView)&&"undefined"!=typeof e.getSelection&&"undefined"!=typeof d.createRange&&(b=window.getSelection())&&"undefined"!=typeof b.removeAllRanges?(c=d.createRange(),c.selectNode(f),0==a&&b.removeAllRanges(),b.addRange(c)):document.body&&"undefined"!=typeof document.body.createTextRange&&(c=document.body.createTextRange())&&(c.moveToElementText(f),c.select())})}},face}),define("lib/nojs/mods/layer",["lib/jquery/jquery","lib/nojs/ui"],function(require){var a=require("lib/jquery/jquery"),b=require("lib/nojs/ui"),c={};return c.overlay=function(d){d=a.extend(!0,{},b.config.overlay,d),d.className=[d.className||"",d.name||""].join(" ");var e=(d.parent?window.parent:window).document;d.insertTo="body"==d.insertTo?e.body:a(e).find(d.insertTo),c.overlay.baseConstructor.call(this,d),this.visible=!1,this.content=null,this.arrow=this.options.arrow,this.timeout=this.options.timeout,this.onShow=this.options.onShow,this.onHide=this.options.onHide,c.overlay.item.push(this),this.init()},b.config.overlay=a.extend({showClassName:"nj_overlay_show",insertTo:"body"},b.config.overlay),b.extend(c.overlay,b.align),b.extend.proto(c.overlay,{set:function(a,b,c){"content"==b?(this.content.empty().append(c),this.options.onContent&&this.options.onContent.call(this,c)):a.call(this,c)}}),c.overlay.item=[],c.overlay.hide=function(){for(var a=c.overlay.item,b=a.length,d=0;b>d;d++)a[d].hide()},c.overlay.prototype.init=function(){this.element=a('<div class="v_hide d_show nj_overlay '+this.options.className+'"><div class="nj_overlay_wrap"></div></div>').appendTo(this.options.insertTo),this.content=this.element.find(".nj_overlay_wrap"),this.arrow&&(this.arrow.element=a('<div class="nj_overlay_arrow"></div>').appendTo(this.element),this.arrow.offset=this.arrow.offset||[0,0]),this._effect=new b.effect(this.element,this.options.effect),this.bind()},c.overlay.prototype.show=function(a){if(!this.visible){var b=this;return this.element.addClass(this.options.showClassName),this.timeout&&(this.autoHide=setTimeout(function(){b.hide()},this.timeout)),this._effect.show(),this.visible=!0,this.set(),a&&a.call(this),void(this.onShow&&this.onShow.call(this))}},c.overlay.prototype.hide=function(a){this.visible&&(this._effect.hide(),this.element.removeClass(this.options.showClassName),this.autoHide=clearTimeout(this.autoHide),this.visible=!1,a&&a.call(this),this.onHide&&this.onHide.call(this))},c.overlay.prototype.on=function(c){c=c||{};var d,e,f,g,h,i,j=this,k=c.mode||b.config.eventType,l="array"==a.type(c.element)&&c.element.length>1,m=!!this.nearby,n=b.dom(l?c.element[0]:c.element)||this.nearby,o=this.options.hoverClass||"nj_overlay_show";if(n){d="mouseover"==k,i=d?" mouseout":"",e=function(b){var f,k,p,q;if(l){if(f=b.target,k=f.tagName.toLowerCase(),q=c.element[1],p=typeof q,"function"==p)q=q.call(f,k);else if("string"==p){if(q=a(f).closest(q),!q.length)return}else q=null;if(!q)return;var r=a("boolean"==typeof q?f:q);j.visible&&j.set("align",{nearby:r}),j.visible&&j.nearby.removeClass(o),j.nearby=r}else m||(n.length>1&&j.hide(),j.nearby=a(this));q=a(this),d?(h=clearTimeout(h),g=setTimeout(function(){l||m||(j.nearby=q),e.e()},50)):!i&&j.visible?j.hide():e.e(),b.preventDefault(),d||c.stopBubble===!1||b.stopPropagation()},e.e=function(){j.show(),j.nearby.addClass(o),c.callback&&c.callback.call(j)},f=function(a){a.stopPropagation(),i?!function(){g=clearTimeout(g),h=setTimeout(function(){j.hide()},10)}():j.hide()};var p=this.onHide;this.onHide=function(){p&&p.call(this),j.nearby&&j.nearby.removeClass(o)},n.on(k,e),i&&n.on(i,f),!d&&!function(){a(document).on(k,f),j.element.on(k,function(a){a.stopPropagation()})}(),d&&this.element.hover(function(){h=clearTimeout(h)},f)}},c.overlay.prototype.destroy=function(){this.element.remove()},c.mask=function(){function c(){h=a('<div id="nj_layer" class="nj_layer"></div>').appendTo(document.body),a.browser.ie&&6==parseInt(a.browser.version)&&(S=function(){h.css({width:g.width(),height:g.height()})},S(),g.on("scroll resize",S),new b.align({element:h})),a.onScroll(h[0]),i.element=h,f=new b.effect(h)}function d(){!document.getElementById("nj_layer")&&c(),h.addClass("nj_layer_show"),f.show()}function e(){h&&f&&(h.removeClass("nj_layer_show"),f.hide())}var f,g=a(window),h=a("#nj_layer"),i={show:d,hide:e};return i}(),c.popup=function(d){d=a.extend(!0,{},b.config.popup,d),d.name=["nj_win",d.name||""].join(" "),d.nearby=d.nearby||(d.parent?window.parent:window),c.popup.baseConstructor.call(this,d),this.theme=d.themeItem[d.theme],this.close=null,this.title=null,this.operating=null,this.mask=0==d.mask?!1:!0,this.bindEsc=0==d.bindEsc?!1:!0,this.onShow=d.onShow,this.onHide=d.onHide,this.create()},b.config.popup={themeItem:{"default":{button:{base:"nj_btn",submit:"n_b_sb"}}},width:400,theme:"default",className:"drop_pop",showClassName:"drop_pop_show"},b.extend(c.popup,c.overlay),b.extend.proto(c.popup,{set:function(a,b,c){if("title"==b)c&&this.title.html(c).show();else if("button"==b){if(this.button=[],this.operating.empty()[c?"show":"hide"](),c)for(var d=0;d<c.length;d++)this.addBtn.apply(this,c[d])}else a.call(this,b,c)},show:function(a,b){this.visible||(this.mask&&c.mask.show(),a.call(this,b),this.bindEsc&&!c.popup.focus[this.key]&&(c.popup.focus[this.key]=this))},hide:function(b,d){if(this.visible){var e=this,f=this.mask;(!this.onbeforehide||this.onbeforehide())&&(b.call(e,d),this.mask&&a.each(c.popup.item,function(){return this.key!=e.key&&this.visible&&this.mask?(f=!1,!1):void 0}),f&&c.mask.hide(),delete c.popup.focus[this.key])}}}),c.popup.prototype.create=function(){var d=this,e="nj_popup_"+ +new Date;c.popup.item[e]=this,this.key=e,this.set("content",['<span class="win_close nj_ico n_i_close">×</span><div class="win_tit"></div>','<div class="win_con clearfix"></div>','<div class="win_opt"></div>'].join("")),this.content.addClass("win_wrap"),this.options.fullScreen?(this.element.css({width:"100%",height:"100%"}),this.position={top:0,left:0},this.element.addClass("full_pop"),this.layer=null):this.element.css({width:this.options.width}),this.element[0].id=e,this.close=this.element.find(".win_close"),this.title=this.element.find(".win_tit").hide(),this.content=this.element.find(".win_con"),this.operating=this.element.find(".win_opt").hide(),this.close.on(b.config.clickEvent,function(){d.hide()}),this.bindEsc&&!c.popup.bind.init&&c.popup.bind(),a.onScroll(this.element[0])},c.popup.prototype.addBtn=function(c,d,e){if(void 0!==c){this.operating.is(":hidden")&&this.operating.show(),this.button=this.button||[];var f=this,g="string"==typeof c&&/[<>]/.test(c),h=a(g?c:'<a href=""></a>'),e=e?e:"",i=this.theme.button||{};"string"==typeof d&&"close"!=d&&(e=d,d=null),!g&&h.attr({"class":"no"==e?"":i.base+" "+(i[e]||"")}),!g&&h.html(c),this.operating.append(h),this.button.push(h),d&&(d="close"==d?function(){f.hide()}:d,h.on(b.config.clickEvent,function(){return d.call(f),!1}))}},c.popup.item={},c.popup.clear=function(a){function b(a){a.self.remove(),a=null}if(a){var d=c.popup.item[a];d&&b(d)}else{for(var e in c.popup.item)b(c.popup.item[e]);c.popup.item={},c.msg.win=null}},c.popup.focus={},c.popup.bind=function(){c.popup.bind.init||(c.popup.bind.init=!0,a(document).on("keydown",function(a){if(27==a.keyCode){var b,d;for(b in c.popup.focus)d=c.popup.focus[b];d&&d.bindEsc&&d.visible&&d.hide()}}))},c.msg=function(){var d={};return b.config.msg={width:null},{show:function(e,f,g){var h="confirm"==e;g=a.extend(!0,{title:h&&"温馨提醒：",bindEsc:h?!0:!1,timeout:1500,mask:h?null:!1},b.config.msg,g);var i=g.button,j=d[e];return this.hide(!0),f=f||"","loading"==e?f=f||"正在处理请求,请稍候……":h&&(i=i||[["确定",function(){j.hide(function(){"function"==typeof g.ok&&g.ok.call(this)})},"submit"],["取消","close"]]),j&&a("#"+j.key).length||(g.name="msg_tip_win msg_tip_"+e+" "+(g.name||""),j=new c.popup(g),j.set("title",g.title),j.set("content",'<div class="con clearfix"><i class="tip_ico nj_ico n_i_'+(h?"warn":e)+'">'+(b.config.iconText[e]||"")+'</i><span class="tip_con"></span></div>'),d[e]=j,h&&(j.onShow=function(){c.mask.element.addClass("higher_layer")},j.onHide=function(){c.mask.element.removeClass("higher_layer")})),j.timeout=h||"loading"==e||g.reload?0:g.timeout,g.reload&&setTimeout(function(){g.reload===!0?location.reload():"string"==typeof g.reload&&(location.href=g.reload)},1500),!i&&j.operating.hide().empty(),j.set("button",i),j.content.find(".tip_con").html(f),j.show(),h&&j.button[0].focus(),j},hide:function(a){for(var b in d)a&&d[b].element.addClass("v_hide"),d[b].hide()}}}(),c}),define("lib/nojs/mods/Switch",["lib/jquery/jquery","lib/nojs/ui"],function(require){function a(b,c){return this instanceof a?void((this.element=d.dom(b))&&(this.menu=this.element.find(".nj_s_menu").first(),this.menuItem=this.menu.find(".nj_s_m"),this.wrap=this.element.find(".nj_s_con").first(),this.item=this.wrap.children(".nj_s_c"),this.length=this.item.length,this.length&&(this.options=c=c||{},this.mode=c.mode||d.config.eventType,this.onChange=c.onChange,this.onHide=c.onHide,this.index=this.getIndex(c.firstIndex),this.rule=c.rule||this.rule,this.options.start=this.options.start===!1?!1:!0,this.bind()))):new a(b,c)}function b(a,c){if(b.baseConstructor.call(this,a,c),this.element){this.play=null,this.time=this.options.time||5e3,this.auto=this.options.auto===!1?!1:!0,this.stopOnHover=this.options.stopOnHover===!1?!1:!0;var d=this;this.stopOnHover&&this.element.hover(function(){d.play=clearInterval(d.play)},function(){d.start()}),this.getNum(),this.options.start&&this.start(!0)}}var c=require("lib/jquery/jquery"),d=require("lib/nojs/ui");return a.prototype={bind:function(){var a,b,d=this,e="mouseover"==this.mode?100:0;this.menuItem&&(this.menuItem.on(this.mode+".nj_switch",function(){return b=c(this),b.hasClass("current")?!1:(d.onTrigger&&d.onTrigger(),a=setTimeout(function(){d.change(d.menuItem.index(b))},e),!1)}).mouseout(function(){a=clearTimeout(a)}),this.options.start&&this.change(this.index))},getIndex:function(a){return a=parseInt(a)||0,a=a>this.length-1?0:a,a=0>a?this.length-1:a},change:function(a){if(a=this.getIndex(a),this.rule){if(this.rule.call(this,a)===!1)return!1}else this.item.eq(a).show().siblings().hide(),this.menuItem.eq(a).addClass("current").siblings().removeClass("current");this.onHide&&this.index!=a&&this.onHide.call(this,this.index),this.index=a,this.onChange&&this.onChange.call(this,a)}},d.extend(b,a),b.prototype.getNum=function(){if(!this.menu.children().length){for(var a="",b=1;b<=this.length;b++)a+='<li class="nj_s_m">'+b+"</li>";this.menu.append(a),this.menuItem=this.menu.find(".nj_s_m"),this.bind()}},b.prototype.onTrigger=function(){!this.stopOnHover&&this.start()},b.prototype.rule=function(a){this.item.eq(a).fadeIn(400).siblings().hide(),this.menuItem.eq(a).addClass("current").siblings().removeClass("current"),this.index=a},b.prototype.start=function(a){var b=this;!this.auto||this.length<2||(a&&this.change(this.index),clearInterval(b.play),b.play=setInterval(function(){b.change(++b.index)},b.time))},{tab:a,slide:b}});