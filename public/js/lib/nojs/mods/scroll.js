/*nolure@vip.qq.com*/define("lib/nojs/mods/scroll",["lib/jquery/jquery","lib/nojs/ui"],function(require){function a(a,b){this.element="string"==typeof a?c("#"+a):a,this.element&&this.element.length&&(this.wrap=this.element.find(".nj_g_wrap").first(),this.con=this.wrap.find(".nj_g_con").first(),this.item=this.con.children(),this.len=this.item.length,this.opt=b=b||{},this.direction=b.direction||"y",this.step="undefined"!=typeof b.step?parseInt(b.step):1,this.time=b.time||(this.step?6e3:30),this.size=null,this.view=null,this.repeat=0==b.repeat?!1:!0,this.auto=0==b.auto?!1:!0,this.index=0,this.init())}function b(a,b){return a=0>a?0:a,a=a>b?a%b:a}var c=require("lib/jquery/jquery"),d=require("lib/nojs/ui");return a.prototype={init:function(){var a=this;if(this.totalLength=this.len,this.scrollLength=0,c(window).on("resize",function(){a.reset()}),this.reset(),!(this.len<=this.view)){var b=this.len%this.view;if(b&&this.append(0,this.step?this.view-b:this.view),"y"==this.direction&&(this.size.total=this.con.height()),this.start(),this.element.hover(function(){a.stop()},function(){a.start()}),screen.width<=640){var e="y"==a.direction?"swipeDown":"swipeRight",f="y"==a.direction?"swipeUp":"swipeLeft";d.touch(function(){a.wrap[e](function(){return a.scroll(!1),!1}),a.wrap[f](function(){return a.scroll(),!1})})}}},append:function(a,b){if(this.repeat){var c,d,e=this.len-a;b>e&&(c=this.item.slice(a).clone(),a=0,b-=c.length),d=this.item.slice(a,a+b).clone(),c=c?c.add(d):d,this.con.append(c),this.totalLength=this.con.children().length,"x"==this.direction&&(this.size.total=this.totalLength*this.size.item,this.con.width(this.size.total))}},start:function(){var a=this;this.auto&&this.len>this.view&&(clearInterval(a.A),this.A=setInterval(function(){a.scroll()},a.time))},stop:function(){this.A=clearInterval(this.A)},scroll:function(a){var c;"number"==typeof a?c=b(a,this.len):a=a===!1?!1:!0,this.wrap.stop();var d,e,f=this,g=0,h=(f.size.total-f.size.box,"x"==this.direction?"scrollLeft":"scrollTop"),i={},j=this.wrap[h](),k=a?1:-1;if(0==this.step?d=1:(d=this.step*this.size.item,g=800),this.step){if(d=k*d,!a&&this.scrollLength<this.step&&"undefined"==typeof c){var l=this.totalLength-(this.scrollLength+this.len);l<this.view&&this.append(this.totalLength%this.len,this.view-l),f.wrap[h](f.wrap[h]()+f.size.item*f.len),this.scrollLength+=this.len}this.scrollLength+=k*this.step}else this.scrollLength=Math.floor(j/f.size.item);this.index=this.scrollLength%this.len,"undefined"==typeof c?(i[h]="+="+d,this[h]=e=j+k*d):(this.scrollLength=c,this.index=c,i[h]=this[h]=e=j=f.size.item*c),this.endIndex=b(this.index+this.view-1,this.len),this.wrap.animate(i,g,"easeOutExpo",function(){if(e>=f.len*f.size.item){var a=f.step?f.size.item*f.index:0;f.wrap[h](a),f.scrollLength=f.index=f.step?f.index:a}var c=f.totalLength-f.scrollLength-f.view;c<f.view&&f.append(b(f.endIndex+c+1,f.len),f.view-c),f.opt.onScrollEnd&&f.opt.onScrollEnd.call(f)}),this.opt.onScroll&&this.opt.onScroll.call(this,this.index)},reset:function(){if(this.opt.computed){var a,b;"x"==this.direction?(b=this.wrap.width(),a="width:"+b+"px;height:"+b/this.opt.computed+"px"):(b=this.wrap.height(),a="width:"+b*this.opt.computed+"px;height:"+b+"px"),this.con.children().attr("style",a)}this.size={box:"x"==this.direction?this.wrap.width():this.wrap.height(),total:"x"==this.direction?null:this.con.height(),item:"x"==this.direction?this.item.outerWidth(!0):this.item.outerHeight(!0)},"x"==this.direction&&(this.size.total=this.totalLength*this.size.item,this.con.width(this.size.total)),this.view=Math.ceil(this.size.box/this.size.item),"view"==this.opt.step&&(this.step=this.view)}},a});